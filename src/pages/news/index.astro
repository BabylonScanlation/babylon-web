---
import Layout from '../../layouts/Layout.astro';
import { SITE_TITLE } from '../../consts';

const response = await fetch(`${Astro.url.origin}/api/news`);
const newsItems = response.ok ? await response.json() : [];
---

<Layout title={`Noticias - ${SITE_TITLE}`}>
  <main class="container mx-auto p-4">
    <h1 class="text-3xl font-bold mb-6">Últimas Noticias</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {
        newsItems.length === 0 ? (
          <p class="col-span-full text-center text-gray-500">
            No hay noticias publicadas aún.
          </p>
        ) : (
          newsItems.map(
            (news: {
              id: any;
              imageUrls: string | any[];
              title: unknown;
              content: unknown;
              createdAt: string | number | Date;
            }) => (
              <a
                href={`/news/${news.id}`}
                class="block bg-white shadow-md rounded-lg overflow-hidden hover:shadow-lg transition-shadow duration-300"
              >
                {news.imageUrls && news.imageUrls.length > 0 && (
                  <img
                    src={String(news.imageUrls[0])}
                    alt={String(news.title)}
                    class="w-full h-48 object-cover"
                  />
                )}
                <div class="p-4">
                  <h2 class="text-xl font-semibold mb-2 text-gray-800">
                    {String(news.title)}
                  </h2>
                  <p class="text-sm text-gray-600 mb-3 line-clamp-3">
                    {String(news.content)}
                  </p>
                  <p class="text-xs text-gray-500">
                    Publicado el {new Date(news.createdAt).toLocaleDateString()}
                  </p>
                </div>
              </a>
            )
          )
        )
      }
    </div>
  </main>
</Layout>
